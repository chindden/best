/**
 * Cloudflare Snippets Domains Query Bookmarklet
 * æµè§ˆå™¨ä¹¦ç­¾è„šæœ¬ - ä¸€é”®æŸ¥è¯¢Cloudflare SnippetsåŸŸå
 * 
 * ä½¿ç”¨æ–¹æ³•:
 * 1. åœ¨æµè§ˆå™¨ä¸­æ–°å»ºä¹¦ç­¾
 * 2. URL å­—æ®µç²˜è´´ä¸‹æ–¹çš„ä»£ç 
 * 3. åœ¨Cloudflare Dashboardæ‰“å¼€æ­¤ä¹¦ç­¾å³å¯æ‰§è¡Œ
 */

javascript:(async()=>{try{console.log('%cğŸ” å¼€å§‹æŸ¥è¯¢Cloudflare SnippetsåŸŸå...','color: #0066cc; font-weight: bold; font-size: 14px');let a=[],b=1,c=true;console.log('ğŸ“‹ ç¬¬ä¸€æ­¥: è·å–è´¦å·ä¸‹çš„æ‰€æœ‰Zone...');for(;c;){const d=await fetch(`/api/v1/zones?per_page=50&page=${b}`,{method:'GET',headers:{'Content-Type':'application/json'},credentials:'include'}),e=await d.json();if(e.success&&e.result){a=a.concat(e.result),c=e.result_info&&e.result_info.page<e.result_info.total_pages,b++,console.log(`  â””â”€ å·²è·å– ${a.length} ä¸ªZone`)}else{console.error('âŒ è·å–Zoneåˆ—è¡¨å¤±è´¥:',e);throw new Error('Failed to fetch zones')}}console.log(`âœ“ å…±æ‰¾åˆ° ${a.length} ä¸ªZone\n`);let f=[],g=[],h=[];console.log('ğŸ” ç¬¬äºŒæ­¥: æ£€æŸ¥æ¯ä¸ªZoneçš„Snippetsæƒé™...\n');for(let i=0;i<a.length;i++){const j=a[i];try{const k=await fetch(`/api/v1/zones/${j.id}/subscription`,{method:'GET',headers:{'Content-Type':'application/json'},credentials:'include'}),l=await k.json();if(l.success&&l.result){const m=l.result.component_values||{};if(m.snippets!==undefined&&m.snippets>0){f.push({name:j.name,zoneId:j.id,snippets:m.snippets,status:j.status,plan:j.plan?j.plan.name:'Unknown'}),console.log(`  âœ“ [${i+1}/${a.length}] ${j.name}\n    â””â”€ Snippetsé…é¢: ${m.snippets}, Plan: ${j.plan?j.plan.name:'Unknown'}`)}else{g.push({name:j.name,zoneId:j.id,plan:j.plan?j.plan.name:'Unknown'}),console.log(`  âœ— [${i+1}/${a.length}] ${j.name} (æœªå¼€é€šSnippets)`)}}else{h.push({name:j.name,zoneId:j.id,error:l.errors?l.errors[0].message:'Unknown error'}),console.log(`  âš  [${i+1}/${a.length}] ${j.name} (æ£€æŸ¥å¤±è´¥)`)}}catch(n){h.push({name:j.name,zoneId:j.id,error:n.message}),console.warn(`  âš  [${i+1}/${a.length}] ${j.name} (å¼‚å¸¸: ${n.message})`)}await new Promise(o=>setTimeout(o,100))}console.log('\n'+'='.repeat(60));console.log('%cğŸ“Š æŸ¥è¯¢ç»“æœç»Ÿè®¡','color: #0066cc; font-weight: bold; font-size: 12px');console.log('='.repeat(60));console.log(`âœ“ å·²å¼€é€šSnippetsçš„åŸŸå: ${f.length}`);console.log(`âœ— æœªå¼€é€šSnippetsçš„åŸŸå: ${g.length}`);console.log(`âš  æ£€æŸ¥å¤±è´¥çš„åŸŸå: ${h.length}`);console.log('='.repeat(60));if(f.length>0){console.log('\n%cå·²å¼€é€šSnippetsæƒé™çš„åŸŸå:','color: #00aa00; font-weight: bold; font-size: 13px');console.table(f.map((p,q)=>({'åºå·':q+1,'åŸŸå':p.name,'Zone ID':p.zoneId,'Snippetsé…é¢':p.snippets,'çŠ¶æ€':p.status,'å¥—é¤':p.plan})))}else{console.log('\n%câŒ æ²¡æœ‰æ‰¾åˆ°å·²å¼€é€šSnippetsæƒé™çš„åŸŸå','color: #ff6600; font-weight: bold')}if(g.length>0){console.log('\n%cæœªå¼€é€šSnippetsæƒé™çš„åŸŸå:','color: #ff9900; font-weight: bold; font-size: 13px');console.table(g.map((r,s)=>({'åºå·':s+1,'åŸŸå':r.name,'Zone ID':r.zoneId,'å¥—é¤':r.plan})))}if(h.length>0){console.log('\n%cæ£€æŸ¥å¤±è´¥çš„åŸŸå:','color: #ff0000; font-weight: bold; font-size: 13px');console.table(h.map((t,u)=>({'åºå·':u+1,'åŸŸå':t.name,'Zone ID':t.zoneId,'é”™è¯¯':t.error})))}window.cfSnippetsResult={timestamp:new Date().toISOString(),summary:{total:a.length,snippetsEnabled:f.length,snippetsDisabled:g.length,errors:h.length},snippetsEnabledZones:f,snippetsDisabledZones:g,errorZones:h};console.log('\n%câœ… æŸ¥è¯¢å®Œæˆï¼ç»“æœå·²ä¿å­˜åˆ°å˜é‡ cfSnippetsResult','color: #00aa00; font-weight: bold; font-size: 12px');console.log('ğŸ’¡ å¯ä»¥åœ¨æ§åˆ¶å°è¾“å…¥ cfSnippetsResult æŸ¥çœ‹å®Œæ•´ç»“æœ');return window.cfSnippetsResult}catch(v){console.error('%câŒ å‘ç”Ÿé”™è¯¯:','color: #ff0000; font-weight: bold',v);throw v}})();
